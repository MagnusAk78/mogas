@import viewdata._

@(instruction: Instruction, domain: Domain, hierarchy: Hierarchy, elementChain: List[Element], 
	interface: Option[Interface], instructionPartListData: utils.ModelListData[InstructionPart], 
	userStatus: UserStatus)(implicit flash: Flash, request: RequestHeader, messages: Messages, webJarAssets: WebJarAssets)

@import templates._
@import components.buttons._
@import components.media._
@import components.utils._
@import forms._

@createModal(instructionPart: InstructionPart) = {
@if(instructionPart.shortText.length > 140) {
<div class="modal" id="@instructionPart.uuid" tabindex="-1" role="dialog" aria-labelledby="@{instructionPart.uuid+"Label"}" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        @instructionPart.text
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
}
}

@main(MainViewData(instruction.name, utils.NavTypes.Instructions, userStatus)) {
	
	@{
		val linkList = List(
			controllers.routes.InstructionController.list("", instructionPartListData.paginateData.page)
		)                
        val captionList = List(
        	Messages("listAll"))
        	
        val activeList = List(false)

        topNavigation(linkList, captionList, activeList)
    }	
    
	@{	 
            var linkList = List(controllers.routes.DomainController.domain(domain.uuid, 1),
                controllers.routes.DomainController.hierarchy(hierarchy.uuid, 1))
                
            var textList = List(domain.name, hierarchy.name)

            for(element <- elementChain) {
                linkList = linkList ::: List(controllers.routes.DomainController.element(element.uuid, 1, 1))

                textList = textList ::: List(element.name)
            }
            
            interface match {
            	case Some(i) => {
            		linkList = linkList ::: List(controllers.routes.DomainController.interface(i.uuid))
            		textList = textList ::: List(i.name)
            	}
            	case None =>
            }
            
            linkList = linkList ::: List(controllers.routes.InstructionController.instruction(instruction.uuid, 1))
            textList = textList ::: List(instruction.name)

            breadcrumb(linkList, textList)
        }

    @rowFullWidth() {
    	@{
    		val newInstructionPartListData = new utils.ModelListData[DbModel with NamedModel with HasShortText] {
    		override val list = instructionPartListData.list map( instructionPart =>
    			 new DbModel with NamedModel with HasShortText {
    			override val uuid = instructionPart.uuid
    			override val name = instruction.name + ": " + instructionPart.orderNumber
    			override val shortText = instructionPart.shortText.take(140)
    			})
    			
    		override val paginateData = instructionPartListData.paginateData
    		override val imageList = instructionPartListData.imageList
    		override val videoList = instructionPartListData.videoList
    	}
   		
   		linkGridWithImageNameAndText(newInstructionPartListData, 
   			controllers.routes.InstructionController.instruction(instruction.uuid, _),
				routes.InstructionController.showPart(_, 1, models.MediaTypes.MediaImage.stringValue), 
				models.Types.InstructionPartType)
		}
	}
	
	@rowLargeSmall() {
    	@editButton(controllers.routes.InstructionController.edit(instruction.uuid), Some(Messages("edit")))
    }{
        @createButton(controllers.routes.InstructionController.createPart(instruction.uuid), Some(Messages("addMore")))
    }
    
	@for(instructionPart <- instructionPartListData.list) {		
  		@createModal(instructionPart)
  	} 
}
